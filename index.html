<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MSBombas | SelecciÃ³n de Bombas I.M.S.</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --azul: #002b55;
  --verde: #00b386;
  --gris: #f4f7f9;
  --blanco: #fff;
}
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: var(--gris);
  margin: 0;
  color: #222;
}
header {
  background: var(--azul);
  color: var(--blanco);
  padding: 20px;
  text-align: center;
}
h1 { margin: 0; font-size: 1.8em; }
.container {
  max-width: 1000px;
  margin: 30px auto;
  background: var(--blanco);
  padding: 25px;
  border-radius: 15px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
select {
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 1em;
}
button {
  background: var(--verde);
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
}
button:hover { background: #009973; }
.info {
  margin-top: 20px;
  background: #e8f9f1;
  border-left: 4px solid var(--verde);
  padding: 15px;
  border-radius: 10px;
}
canvas { margin-top: 30px; }
footer {
  background: var(--azul);
  color: var(--blanco);
  text-align: center;
  padding: 15px;
  margin-top: 40px;
  font-size: 0.9em;
}
.resena {
  margin-top: 30px;
  background: #f1f6fc;
  border-left: 4px solid var(--azul);
  padding: 15px;
  border-radius: 10px;
  font-size: 0.95em;
}
@media (max-width: 600px) {
  input, select { width: 100%; }
}
</style>
</head>
<body>

<header>
  <h1>ðŸ”§ SelecciÃ³n de Bombas HidrÃ¡ulicas I.M.S.</h1>
  <p>Simulador tÃ©cnico de curvas, potencias y rendimiento</p>
</header>

<div class="container">
  <h2>ðŸ§­ SelecciÃ³n tÃ©cnica</h2>

  <label>Tipo de bomba:</label>
  <select id="tipoBomba"></select>

  <label>Modelo:</label>
  <select id="modelo"></select>

  <label>RPM:</label>
  <select id="rpm"></select>

  <label>Tipo de motor:</label>
  <select id="tipoMotor">
    <option value="ElÃ©ctrico">ElÃ©ctrico</option>
    <option value="Bencinero">Bencinero</option>
    <option value="DiÃ©sel">DiÃ©sel</option>
  </select>

  <label>Potencia del motor (HP):</label>
  <select id="potencia"></select>

  <button onclick="mostrarDatos()">Mostrar caracterÃ­sticas</button>

  <div id="info" class="info"></div>
  <canvas id="grafico"></canvas>

  <div class="resena">
    <h3>ðŸ“˜ CÃ³mo interpretar la curva</h3>
    <p>
      El eje <b>X</b> representa el <b>caudal (L/min)</b>, es decir, el volumen de agua que bombea la bomba.<br>
      El eje <b>Y</b> muestra la <b>altura manomÃ©trica (m)</b> y la <b>potencia del motor (HP)</b>. 
      <ul>
        <li>ðŸŸ¦ <b>Curva azul:</b> indica la presiÃ³n o altura que la bomba entrega segÃºn el caudal.</li>
        <li>ðŸŸ© <b>Curva verde:</b> muestra la potencia absorbida por el motor.</li>
        <li>ðŸŸ§ <b>Curva naranja:</b> representa la eficiencia (%), ideal entre 70 y 85%.</li>
        <li>ðŸ”´ <b>Curva roja:</b> (si aparece) muestra el <b>NPSH requerido</b> para evitar cavitaciÃ³n.</li>
      </ul>
      En general, una bomba trabaja mejor cerca de su <b>punto de mÃ¡xima eficiencia (BEP)</b>,
      donde se logra el mejor equilibrio entre caudal, altura y consumo.
    </p>
  </div>
</div>

<footer>
  Â© 2025 MSBombas | Desarrollado por zuriciver-web
</footer>

<script>
let dataBombas = {};
let chart = null;

// Cargar el JSON
fetch("./bombas_ims.json")
  .then(res => res.json())
  .then(data => {
    dataBombas = data.series;
    cargarTipos();
  });

// Cargar los tipos de bomba
function cargarTipos() {
  const select = document.getElementById("tipoBomba");
  select.innerHTML = '<option value="">-- Seleccione --</option>';
  dataBombas.forEach(s => {
    const opt = document.createElement("option");
    opt.value = s.nombre;
    opt.textContent = s.nombre + " (" + s.descripcion + ")";
    select.appendChild(opt);
  });
  select.addEventListener("change", cargarModelos);
}

function cargarModelos() {
  const tipo = document.getElementById("tipoBomba").value;
  const selectModelo = document.getElementById("modelo");
  selectModelo.innerHTML = '<option value="">-- Seleccione --</option>';
  const serie = dataBombas.find(s => s.nombre === tipo);
  if (!serie) return;
  serie.modelos.forEach(m => {
    const opt = document.createElement("option");
    opt.value = m.codigo;
    opt.textContent = m.codigo;
    selectModelo.appendChild(opt);
  });
  selectModelo.addEventListener("change", cargarRPM);
}

function cargarRPM() {
  const tipo = document.getElementById("tipoBomba").value;
  const modelo = document.getElementById("modelo").value;
  const serie = dataBombas.find(s => s.nombre === tipo);
  const mod = serie.modelos.find(m => m.codigo === modelo);
  const selectRPM = document.getElementById("rpm");
  selectRPM.innerHTML = "";
  if (Array.isArray(mod.rpm)) {
    mod.rpm.forEach(r => {
      const opt = document.createElement("option");
      opt.value = r;
      opt.textContent = r + " RPM";
      selectRPM.appendChild(opt);
    });
  } else {
    const opt = document.createElement("option");
    opt.value = mod.rpm;
    opt.textContent = mod.rpm + " RPM";
    selectRPM.appendChild(opt);
  }
  cargarHP();
}

function cargarHP() {
  const tipo = document.getElementById("tipoBomba").value;
  const modelo = document.getElementById("modelo").value;
  const serie = dataBombas.find(s => s.nombre === tipo);
  const mod = serie.modelos.find(m => m.codigo === modelo);
  const select = document.getElementById("potencia");
  select.innerHTML = "";
  (mod.motor || mod.potencia_hp).forEach(hp => {
    const opt = document.createElement("option");
    opt.value = hp;
    opt.textContent = hp;
    select.appendChild(opt);
  });
}

function mostrarDatos() {
  const tipo = document.getElementById("tipoBomba").value;
  const modelo = document.getElementById("modelo").value;
  const rpm = document.getElementById("rpm").value;
  const serie = dataBombas.find(s => s.nombre === tipo);
  if (!serie) return;
  const mod = serie.modelos.find(m => m.codigo === modelo);
  if (!mod) return;

  let curvaSeleccionada = mod.curva;
  if (typeof mod.curva === "object") curvaSeleccionada = mod.curva[rpm];

  let html = `<h3>CaracterÃ­sticas ${mod.codigo}</h3>`;
  html += `<b>Serie:</b> ${serie.nombre}<br>`;
  html += `<b>RPM:</b> ${rpm}<br>`;
  html += `<b>Impulsor (mm):</b> ${mod.diametro_impulsor_mm ? mod.diametro_impulsor_mm.join(", ") : "N/D"}<br>`;
  html += `<b>Caudal (L/min):</b> ${mod.caudal_lmin.join(", ")}<br>`;
  html += `<b>Altura (m):</b> ${mod.altura_m.join(", ")}<br>`;
  html += `<b>Potencia (HP):</b> ${mod.potencia_hp.join(", ")}<br>`;
  html += `<b>NPSH (m):</b> ${mod.npsh_m ? mod.npsh_m.join(", ") : "N/D"}<br>`;
  if (mod.dimensiones)
    html += `<b>Dimensiones (mm):</b> A=${mod.dimensiones.A}, B=${mod.dimensiones.B}, C=${mod.dimensiones.C}, Peso=${mod.dimensiones.peso_kg} kg<br>`;
  html += `<b>Curva:</b> ${curvaSeleccionada ? curvaSeleccionada : "No disponible"}<br>`;
  document.getElementById("info").innerHTML = html;

  mostrarGrafico(mod);
}

function mostrarGrafico(mod) {
  const ctx = document.getElementById("grafico").getContext("2d");
  if (chart) chart.destroy();

  const eficiencia = mod.eficiencia || mod.caudal_lmin.map((_, i) => Math.max(60, 85 - i * 5));

  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: mod.caudal_lmin,
      datasets: [
        { label: "Altura (m)", data: mod.altura_m, borderColor: "#002b55", yAxisID: "yH", fill: false, tension: 0.3 },
        { label: "Potencia (HP)", data: mod.potencia_hp, borderColor: "#00b386", yAxisID: "yP", fill: false, tension: 0.3 },
        { label: "Eficiencia (%)", data: eficiencia, borderColor: "#ff9800", yAxisID: "yE", fill: false, tension: 0.3, borderDash: [5, 5] },
        ...(mod.npsh_m ? [{ label: "NPSH (m)", data: mod.npsh_m, borderColor: "#e53935", yAxisID: "yN", fill: false, tension: 0.3, borderDash: [2, 4] }] : [])
      ]
    },
    options: {
      responsive: true,
      interaction: { mode: "index", intersect: false },
      stacked: false,
      scales: {
        x: { title: { display: true, text: "Caudal (L/min)" } },
        yH: { type: "linear", position: "left", title: { display: true, text: "Altura (m)" }, grid: { drawOnChartArea: false } },
        yP: { type: "linear", position: "right", title: { display: true, text: "Potencia (HP)" }, grid: { drawOnChartArea: false } },
        yE: { type: "linear", position: "left", min: 50, max: 100, display: true, title: { display: true, text: "Eficiencia (%)" }, grid: { drawOnChartArea: false } },
        yN: { type: "linear", position: "right", display: !!mod.npsh_m, title: { display: true, text: "NPSH (m)" }, grid: { drawOnChartArea: false } }
      },
      plugins: { legend: { position: "top" }, tooltip: { enabled: true } }
    }
  });
}
</script>

</body>
</html>
